<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moonlight on Maple Hollow - A Paranormal Romance</title>
    
    <!-- 
    ==========================================
    IMAGE PLACEHOLDERS - ADD YOUR URLS HERE:
    ==========================================
    
    Search for these comments to add your images:
    
    1. "Book Cover Placeholder" - Line ~95
       Replace placeholder div with: <img src="YOUR_BOOK_COVER_URL" ... />
    
    2. "Ethan Image Placeholder" - Line ~280
       Replace placeholder div with: <img src="YOUR_ETHAN_IMAGE_URL" ... />
    
    3. "Caleb Image Placeholder" - Line ~310
       Replace placeholder div with: <img src="YOUR_CALEB_IMAGE_URL" ... />
    
    ==========================================
    -->
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Markdown rendering and sanitization for chapter previews -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=Source+Sans+Pro:wght@300;400;600;700&family=Lora:wght@400;500&display=swap');

        :root {
            /* Theme palette (from mockup) */
            --warm-cream: #F5EFE7;
            --honey-amber: #D4A574;
            --golden-glow: #F4D58D;
            --twilight-cocoa: #2D1810;
            --mid-cocoa: #3D2820;
            --deep-cocoa: #2D1810;
            --autumn-rust: #B8733E;
            --rust: #8B5A2B;
            --soft-moonlight: #FFF8E7;
            --misty-lavender: #D4C4D8;
            --warm-charcoal: #3D3028;
            --soft-sage: #B8C5B0;
            --cozy-rose: #D4A5A5;
            /* Fog tones */
            --fog-a: rgba(245, 239, 231, 0.03);
            --fog-b: rgba(245, 239, 231, 0.08);
            --fog-c: rgba(245, 239, 231, 0.03);
        }
        
        body {
            font-family: 'Source Sans Pro', sans-serif;
            color: var(--warm-cream);
            background: linear-gradient(180deg, var(--twilight-cocoa) 0%, var(--mid-cocoa) 50%, var(--twilight-cocoa) 100%);
        }
        
        .heading-font {
            font-family: 'Cormorant Garamond', serif;
        }
        
        .fog-effect {
            background: linear-gradient(180deg, var(--fog-a) 0%, var(--fog-b) 50%, var(--fog-c) 100%);
            animation: fogDrift 20s ease-in-out infinite;
        }
        
        @keyframes fogDrift {
            0%, 100% { opacity: 0.3; transform: translateX(0); }
            50% { opacity: 0.6; transform: translateX(20px); }
        }
        
        @keyframes moonGlow {
            0%, 100% { box-shadow: 0 0 40px rgba(244, 213, 141, 0.5); }
            50% { box-shadow: 0 0 80px rgba(244, 213, 141, 0.7); }
        }
        
        .moon-glow {
            animation: moonGlow 4s ease-in-out infinite;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 1s ease-out forwards;
        }
        
        .autumn-gradient {
            background: linear-gradient(135deg, var(--honey-amber) 0%, var(--autumn-rust) 50%, var(--rust) 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        
        .timeline-dot {
            transition: all 0.3s ease;
        }
        
        .timeline-dot:hover {
            transform: scale(1.3);
        }

        /* Reader spacing fallback if typography plugin isn't present */
        .chapter-content p { margin-bottom: 1.25em; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Shared chapters list for navigation and reader
        const CHAPTERS = [
            { id: 1,  title: 'Chapter 1 — Homecoming Fog',                 file: 'chapter-1-homecoming-fog.md',               blurb: 'Ethan returns to Maple Hollow through the mist.' },
            { id: 2,  title: 'Chapter 2 — Alpha at the Bar',               file: 'chapter-2-alpha-at-the-bar.md',             blurb: 'Old wounds resurface under warm tavern lights.' },
            { id: 3,  title: 'Chapter 3 — Lanterns and Laughter',          file: 'chapter-3-lanterns-and-laughter.md',        blurb: 'Festival magic begins at dusk in Harvest Square.' },
            { id: 4,  title: 'Chapter 4 — Quiet Patrol',                    file: 'chapter-4-quiet-patrol.md',                 blurb: 'Caleb walks the town’s boundary and hears what needs care.' },
            { id: 5,  title: 'Chapter 5 — Welcome, Maple Hollow',          file: 'chapter-5-welcome-maple-hollow.md',         blurb: 'Opening ceremony—welcome becomes a shared promise.' },
            { id: 6,  title: 'Chapter 6 — Late-Shift Glow',                 file: 'chapter-6-late-shift-glow.md',              blurb: 'A quiet café becomes a place for careful honesty.' },
            { id: 7,  title: 'Chapter 7 — The Interview That Became Breakfast', file: 'chapter-7-the-interview-that-became-breakfast.md', blurb: 'Questions turn into truths at Aunt Sophie’s table.' },
            { id: 8,  title: 'Chapter 8 — Storm Signs',                      file: 'chapter-8-storm-signs.md',                  blurb: 'The weather turns and so do expectations.' },
            { id: 9,  title: 'Chapter 9 — Shelter and Sparks',              file: 'chapter-9-shelter-and-sparks.md',           blurb: 'Forced closeness reveals warmth neither expected.' },
            { id: 10, title: 'Chapter 10 — Words on Fire',                  file: 'chapter-10-words-on-fire.md',               blurb: 'Truths ignite; the town listens.' },
            { id: 11, title: 'Chapter 11 — Bridges Before Dawn',            file: 'chapter-11-bridges-before-dawn.md',         blurb: 'Before sunrise, they choose how to cross.' },
            { id: 12, title: 'Chapter 12 — Flour and Firelight',            file: 'chapter-12-flour-and-firelight.md',         blurb: 'Domestic intimacy, hands steady in shared work.' },
            { id: 13, title: 'Chapter 13 — The Morning After the Moon',     file: 'chapter-13-the-morning-after-the-moon.md',  blurb: 'New beginnings in the soft light.' },
        ];

        // Fix common mojibake sequences from mis-decoded UTF-8 smart punctuation
        const fixMojibake = (s) => {
            if (!s || typeof s !== 'string') return s;
            return s
                .replace(/â€™/g, '’')  // right single quote
                .replace(/â€˜/g, '‘')  // left single quote
                .replace(/â€œ/g, '“')  // left double quote
                .replace(/â€/g, '”')  // right double quote
                .replace(/â€“/g, '–')  // en dash
                .replace(/â€”/g, '—')  // em dash
                .replace(/â€¦/g, '…')  // ellipsis
                .replace(/Â /g, ' ')   // stray non-breaking space marker
                ;
        };

        const MoonlightPromo = () => {
            const tabs = ['home', 'story', 'chapters', 'characters', 'journey', 'themes'];
            const initialTab = (() => {
                try {
                    const h = window.location.hash ? window.location.hash.slice(1) : '';
                    return tabs.includes(h) ? h : 'home';
                } catch { return 'home'; }
            })();
            const [activeTab, setActiveTab] = useState(initialTab);
            const [hoveredChapter, setHoveredChapter] = useState(null);
            const [selectedQuote, setSelectedQuote] = useState(0);
            
            const quotes = [
                {
                    text: "Mist swallowed the last road sign before Maple Hollow—appropriate for a place that preferred its secrets blurred.",
                    chapter: "Chapter 1"
                },
                {
                    text: "Magic, to Maple Hollow, wasn't mystic or even particularly special—just another local industry, like maple syrup or gossip.",
                    chapter: "Chapter 1"
                },
                {
                    text: "The name rose like a moon in his chest—bright, inevitable, and completely unwelcome.",
                    chapter: "Chapter 2"
                },
                {
                    text: "He'd been a good Alpha with a particular kind of tension underneath everything.",
                    chapter: "Chapter 2"
                }
            ];
            
            const journeyPoints = [
                { chapter: 1, title: "Homecoming Fog", emotion: "Returning to haunted memories", color: "bg-slate-600" },
                { chapter: 2, title: "Alpha at the Bar", emotion: "Old wounds resurface", color: "bg-amber-700" },
                { chapter: 3, title: "Lanterns and Laughter", emotion: "Festival magic begins", color: "bg-orange-600" },
                { chapter: 5, title: "Welcome, Maple Hollow", emotion: "Community embrace", color: "bg-yellow-700" },
                { chapter: 7, title: "The Interview", emotion: "Professional masks slip", color: "bg-amber-600" },
                { chapter: 9, title: "Shelter and Sparks", emotion: "Storm forces closeness", color: "bg-orange-700" },
                { chapter: 10, title: "Words on Fire", emotion: "Truths ignite", color: "bg-red-800" },
                { chapter: 12, title: "Flour and Firelight", emotion: "Domestic intimacy", color: "bg-amber-500" },
                { chapter: 13, title: "Morning After the Moon", emotion: "New beginnings", color: "bg-yellow-600" }
            ];
            
            useEffect(() => {
                const interval = setInterval(() => {
                    setSelectedQuote(prev => (prev + 1) % quotes.length);
                }, 6000);
                return () => clearInterval(interval);
            }, []);

            // Keep URL hash in sync for deep-linking (#home, #chapters etc.)
            useEffect(() => {
                try {
                    const target = `#${activeTab}`;
                    if (window.location.hash !== target) {
                        history.replaceState(null, '', target);
                    }
                } catch {}
            }, [activeTab]);

            // Respond to browser hash changes (back/forward)
            useEffect(() => {
                const onHash = () => {
                    try {
                        const h = window.location.hash ? window.location.hash.slice(1) : '';
                        if (tabs.includes(h)) setActiveTab(h);
                    } catch {}
                };
                window.addEventListener('hashchange', onHash);
                return () => window.removeEventListener('hashchange', onHash);
            }, []);
            
            return (
                <div className="min-h-screen">
                    {/* Navigation Tabs (sticky, always at top) */}
                    
                    <div className="sticky top-0 z-50 bg-zinc-900/95 backdrop-blur border-b border-amber-800/30">
                        <div className="max-w-6xl mx-auto px-6 py-4">
                            <div className="flex gap-4 items-center justify-center md:justify-between flex-wrap">
                                {['home', 'chapters', 'story', 'characters', 'journey', 'themes'].map(tab => (
                                    <button
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className={`px-6 py-2 rounded-lg transition-all ${
                                            activeTab === tab 
                                                ? 'bg-amber-700 text-white' 
                                                : 'text-amber-300 hover:text-amber-100 hover:bg-amber-900/30'
                                        }`}
                                    >
                                        {tab.charAt(0).toUpperCase() + tab.slice(1)}
                                    </button>
                                ))}

                                {/* Chapters quick-jump dropdown */}
                                <div className="w-full md:w-auto md:ml-auto">
                                    <label htmlFor="chapterJump" className="sr-only">Jump to chapter</label>
                                    <select
                                        id="chapterJump"
                                        className="w-full md:w-auto bg-zinc-900/40 border border-amber-800/30 text-amber-200 rounded px-3 py-2"
                                        onChange={(e) => {
                                            const idx = Number(e.target.value);
                                            if (!Number.isNaN(idx)) {
                                                setActiveTab('chapters');
                                                try { history.replaceState(null, '', '#chapters'); } catch {}
                                                window.dispatchEvent(new CustomEvent('chapters:select', { detail: idx }));
                                            }
                                        }}
                                        defaultValue=""
                                    >
                                        <option value="" disabled>Jump to chapter…</option>
                                        {CHAPTERS.map((c, idx) => (
                                            <option key={c.id} value={idx}>{c.title}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Home Section (previously above the navbar) */}
                    {activeTab === 'home' && (
                        <div className="relative h-screen flex items-center justify-center overflow-hidden">
                            <div className="absolute inset-0 fog-effect"></div>
                            {/* Decorative Moon */}
                            <div className="absolute top-20 right-20 w-32 h-32 rounded-full bg-gradient-to-br from-[var(--golden-glow)] to-[var(--honey-amber)] moon-glow opacity-80"></div>
                            <div className="relative z-10 text-center px-6 fade-in">
                                {/* Book Cover Placeholder - ADD YOUR IMAGE URL HERE */}
                                <div className="mb-8 flex justify-center">
                                    <div className="w-64 h-96 bg-gradient-to-br from-[#D4A574]/60 to-[#B8733E]/60 rounded-lg border-2 shadow-2xl overflow-hidden flex items-center justify-center" style={{ borderColor: 'var(--honey-amber)' }}>
                                        <img src="https://xierykaufosmdkcxzfex.supabase.co/storage/v1/object/public/image-gen/maplewood-cover.png" alt="Moonlight on Maple Hollow Book Cover" className="w-full h-full object-cover rounded-lg" />
                                    </div>
                                </div>
                                <h1 className="heading-font text-7xl md:text-8xl font-bold mb-6 text-amber-100">Moonlight on Maple Hollow</h1>
                                <p className="text-2xl md:text-3xl text-amber-200 mb-4 italic">A Paranormal Romance</p>
                                <p className="text-xl text-amber-300 max-w-2xl mx-auto mb-8">
                                    When a skeptical journalist returns to his haunted hometown, he rekindles a forbidden bond with the local Alpha—and discovers that some loves are worth the risk of being seen.
                                </p>
                                <div className="flex gap-4 justify-center flex-wrap text-sm">
                                    <span className="px-4 py-2 bg-amber-900/50 rounded-full border border-amber-600">Small Town</span>
                                    <span className="px-4 py-2 bg-amber-900/50 rounded-full border border-amber-600">Shifter Romance</span>
                                    <span className="px-4 py-2 bg-amber-900/50 rounded-full border border-amber-600">Second Chance</span>
                                    <span className="px-4 py-2 bg-amber-900/50 rounded-full border border-amber-600">Slow Burn</span>
                                    <span className="px-4 py-2 bg-amber-900/50 rounded-full border border-amber-600">Found Family</span>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Story Section */}
                    {activeTab === 'story' && (
                        <div className="max-w-6xl mx-auto px-6 py-20">
                            <h2 className="heading-font text-5xl font-bold text-amber-100 mb-8 text-center">
                                The Story
                            </h2>
                            
                            <div className="grid md:grid-cols-2 gap-12 mb-16">
                                <div className="bg-zinc-900/60 p-8 rounded-lg border border-amber-800/30">
                                    <h3 className="heading-font text-3xl font-semibold text-amber-200 mb-4">
                                        The Setting
                                    </h3>
                                    <p className="text-amber-100/90 leading-relaxed mb-4">
                                        Maple Hollow is a misty Appalachian town where October lingers in perpetual twilight. Here, folklore and reality blur, pumpkins line every porch, and the full moon holds more power than most outsiders realize.
                                    </p>
                                    <p className="text-amber-100/90 leading-relaxed">
                                        This is a place where magic isn't mystical—it's as natural as maple syrup. Where the barber moonlights as a bear, and protection runes are carved into doorframes alongside welcome signs.
                                    </p>
                                </div>
                                
                                <div className="bg-zinc-900/60 p-8 rounded-lg border border-amber-800/30">
                                    <h3 className="heading-font text-3xl font-semibold text-amber-200 mb-4">
                                        The Romance
                                    </h3>
                                    <p className="text-amber-100/90 leading-relaxed mb-4">
                                        Twelve years ago, Ethan Cole fled Maple Hollow—and the boy who broke his heart. Now he's back as a journalist covering the Harvest Moon Festival, determined to keep his distance.
                                    </p>
                                    <p className="text-amber-100/90 leading-relaxed">
                                        But Caleb Hawthorne, now the town's Alpha and keeper of secrets, has been waiting. Between them lies a past that needs healing, a present crackling with tension, and a future that depends on whether they can trust each other again.
                                    </p>
                                </div>
                            </div>
                            
                            {/* Rotating Quotes */}
                            <div className="bg-gradient-to-br from-amber-900/40 to-orange-900/40 p-12 rounded-lg border border-amber-600/40 text-center">
                                <div className="max-w-3xl mx-auto">
                                    <p className="heading-font text-3xl italic text-amber-100 mb-4 min-h-24 flex items-center justify-center">
                                        "{quotes[selectedQuote].text}"
                                    </p>
                                    <p className="text-amber-300 text-sm">
                                        — {quotes[selectedQuote].chapter}
                                    </p>
                                </div>
                                <div className="flex gap-2 justify-center mt-6">
                                    {quotes.map((_, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => setSelectedQuote(idx)}
                                            className={`w-2 h-2 rounded-full transition-all ${
                                                selectedQuote === idx ? 'bg-amber-400 w-8' : 'bg-amber-700'
                                            }`}
                                        />
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Characters Section */}
                    {activeTab === 'characters' && (
                        <div className="max-w-6xl mx-auto px-6 py-20">
                            <h2 className="heading-font text-5xl font-bold text-amber-100 mb-12 text-center">
                                Meet the Characters
                            </h2>
                            
                            <div className="grid md:grid-cols-2 gap-8 mb-16">
                                {/* Ethan Card */}
                                <div className="bg-gradient-to-br from-slate-800 to-slate-900 p-8 rounded-lg border border-slate-600 card-hover">
                                    <div className="flex items-center mb-6">
                                        {/* Ethan Image Placeholder - ADD YOUR IMAGE URL HERE */}
                                        <div className="w-28 h-28 rounded-2xl overflow-hidden border-4 border-amber-600 flex-shrink-0">
                                            <img src="https://xierykaufosmdkcxzfex.supabase.co/storage/v1/object/public/image-gen/mc-1-ethan-v2.png" alt="Ethan Cole" className="w-full h-full object-cover object-center scale-110" />
                                        </div>
                                        <div className="ml-4">
                                            <h3 className="heading-font text-3xl font-bold text-amber-100">Ethan Cole</h3>
                                            <p className="text-amber-300 italic">The Skeptical Journalist</p>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-4 text-amber-100/90">
                                        <p>
                                            <span className="font-semibold text-amber-300">Age:</span> 30 | 
                                            <span className="font-semibold text-amber-300 ml-2">Profession:</span> Investigative Journalist
                                        </p>
                                        <p className="leading-relaxed">
                                            Lean and sharp-featured with wind-tousled dark curls, Ethan carries the weight of old wounds behind witty observations. He left Maple Hollow at eighteen, fleeing grief and heartbreak, and built a career exposing truth in the city.
                                        </p>
                                        <p className="leading-relaxed">
                                            Now burnout and loneliness have brought him home for what should be a simple assignment. But facing Caleb—and the supernatural world he once knew—proves anything but simple.
                                        </p>
                                        <div className="pt-4 border-t border-slate-700">
                                            <p className="text-sm italic text-amber-300">
                                                "Curious, emotionally cautious, hides vulnerability behind humor"
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Caleb Card */}
                                <div className="bg-gradient-to-br from-amber-900 to-orange-900 p-8 rounded-lg border border-amber-700 card-hover">
                                    <div className="flex items-center mb-6">
                                        {/* Caleb Image Placeholder - ADD YOUR IMAGE URL HERE */}
                                        <div className="w-28 h-28 rounded-2xl overflow-hidden border-4 border-amber-400 flex-shrink-0">
                                            <img src="https://xierykaufosmdkcxzfex.supabase.co/storage/v1/object/public/image-gen/mc-2-caleb-2.png" alt="Caleb Hawthorne" className="w-full h-full object-cover object-center scale-125" />
                                        </div>
                                        <div className="ml-4">
                                            <h3 className="heading-font text-3xl font-bold text-amber-50">Caleb Hawthorne</h3>
                                            <p className="text-amber-200 italic">The Patient Alpha</p>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-4 text-amber-50/90">
                                        <p>
                                            <span className="font-semibold text-amber-200">Age:</span> 32 | 
                                            <span className="font-semibold text-amber-200 ml-2">Role:</span> Pack Alpha & Tavern Owner
                                        </p>
                                        <p className="leading-relaxed">
                                            Tall and broad-shouldered with tawny hair and green eyes that glow gold in moonlight, Caleb inherited Alpha leadership young. When Ethan left, he chose duty over love—a decision that haunts him still.
                                        </p>
                                        <p className="leading-relaxed">
                                            Years of protecting Maple Hollow have made him respected but lonely. Now Ethan's return forces him to question whether strength means always sacrificing what he wants most.
                                        </p>
                                        <div className="pt-4 border-t border-amber-800">
                                            <p className="text-sm italic text-amber-200">
                                                "Steady, protective, patient—but yearning to be seen simply as himself"
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Supporting Cast Teaser */}
                            <div className="bg-zinc-900/60 p-8 rounded-lg border border-amber-800/30">
                                <h3 className="heading-font text-3xl font-semibold text-amber-200 mb-6 text-center">
                                    The Heart of Maple Hollow
                                </h3>
                                <div className="grid md:grid-cols-3 gap-6 text-center">
                                    <div>
                                        <p className="font-semibold text-amber-300 mb-2">Mayor Dorothea Vance</p>
                                        <p className="text-sm text-amber-100/80">The town's sharp-eyed matriarch who sees everything</p>
                                    </div>
                                    <div>
                                        <p className="font-semibold text-amber-300 mb-2">Ruby Cole</p>
                                        <p className="text-sm text-amber-100/80">Ethan's vibrant cousin and local podcaster</p>
                                    </div>
                                    <div>
                                        <p className="font-semibold text-amber-300 mb-2">Jasper Reed</p>
                                        <p className="text-sm text-amber-100/80">The Wildwood's bartender who reads people like books</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Chapters Section */}
                    {activeTab === 'chapters' && (
                        <div className="max-w-6xl mx-auto px-6 py-20">
                            <h2 className="heading-font text-5xl font-bold text-amber-100 mb-4 text-center">
                                Chapter Previews
                            </h2>
                            <p className="text-amber-300 text-center mb-10">
                                Early draft excerpts. Content may change before final release.
                            </p>

                            {/* Chapters List + Reader */}
                            <ChaptersViewer />
                        </div>
                    )}
                    
                    {/* Journey Section */}
                    {activeTab === 'journey' && (
                        <div className="max-w-6xl mx-auto px-6 py-20">
                            <h2 className="heading-font text-5xl font-bold text-amber-100 mb-8 text-center">
                                The Emotional Journey
                            </h2>
                            <p className="text-xl text-amber-300 text-center mb-16 max-w-3xl mx-auto">
                                Follow Ethan and Caleb through thirteen chapters of slow-burning tension, healing, and rediscovery under the Harvest Moon.
                            </p>
                            
                            {/* Timeline */}
                            <div className="relative">
                                {/* Connection Line */}
                                <div className="absolute left-1/2 top-0 bottom-0 w-1 bg-gradient-to-b from-amber-700 via-orange-600 to-amber-700 transform -translate-x-1/2 hidden md:block"></div>
                                
                                <div className="space-y-12">
                                    {journeyPoints.map((point, idx) => (
                                        <div
                                            key={point.chapter}
                                            className={`flex items-center gap-8 ${idx % 2 === 0 ? 'md:flex-row' : 'md:flex-row-reverse'}`}
                                            onMouseEnter={() => setHoveredChapter(point.chapter)}
                                            onMouseLeave={() => setHoveredChapter(null)}
                                        >
                                            <div className={`flex-1 ${idx % 2 === 0 ? 'text-right' : 'text-left'} hidden md:block`}>
                                                <div className={`inline-block p-6 rounded-lg border transition-all ${
                                                    hoveredChapter === point.chapter
                                                        ? 'bg-amber-900/60 border-amber-600 transform scale-105'
                                                        : 'bg-zinc-900/60 border-amber-800/30'
                                                }`}>
                                                    <h4 className="heading-font text-2xl font-semibold text-amber-200 mb-2">
                                                        Chapter {point.chapter}: {point.title}
                                                    </h4>
                                                    <p className="text-amber-100/80 italic">{point.emotion}</p>
                                                </div>
                                            </div>
                                            
                                            <div className={`w-12 h-12 rounded-full ${point.color} border-4 border-amber-900 flex items-center justify-center font-bold text-white z-10 timeline-dot cursor-pointer`}>
                                                {point.chapter}
                                            </div>
                                            
                                            <div className="flex-1 md:hidden">
                                                <div className={`p-6 rounded-lg border transition-all ${
                                                    hoveredChapter === point.chapter
                                                        ? 'bg-amber-900/60 border-amber-600'
                                                        : 'bg-zinc-900/60 border-amber-800/30'
                                                }`}>
                                                    <h4 className="heading-font text-2xl font-semibold text-amber-200 mb-2">
                                                        Chapter {point.chapter}: {point.title}
                                                    </h4>
                                                    <p className="text-amber-100/80 italic">{point.emotion}</p>
                                                </div>
                                            </div>
                                            
                                            <div className="flex-1 hidden md:block"></div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="mt-16 text-center">
                                <p className="text-amber-300 text-lg italic">
                                    Each chapter deepens the connection, reveals hidden truths, and brings them closer to the moment they must choose: flee again, or finally come home to each other.
                                </p>
                            </div>
                        </div>
                    )}
                    
                    {/* Themes Section */}
                    {activeTab === 'themes' && (
                        <div className="max-w-6xl mx-auto px-6 py-20">
                            <h2 className="heading-font text-5xl font-bold text-amber-100 mb-12 text-center">
                                Themes & Atmosphere
                            </h2>
                            
                            <div className="grid md:grid-cols-2 gap-8 mb-12">
                                <div className="bg-gradient-to-br from-orange-900/40 to-red-900/40 p-8 rounded-lg border border-orange-700/50">
                                    <h3 className="heading-font text-3xl font-semibold text-amber-200 mb-4">
                                        🍂 Autumn Atmosphere
                                    </h3>
                                    <p className="text-amber-100/90 leading-relaxed">
                                        October fog rolling through ancient forests. Applewood smoke and cinnamon spice. Full moons that hold more power than science allows. Every detail is chosen to evoke the season of transformation.
                                    </p>
                                </div>
                                
                                <div className="bg-gradient-to-br from-amber-900/40 to-yellow-900/40 p-8 rounded-lg border border-amber-700/50">
                                    <h3 className="heading-font text-3xl font-semibold text-amber-200 mb-4">
                                        🌙 Paranormal as Metaphor
                                    </h3>
                                    <p className="text-amber-100/90 leading-relaxed">
                                        Shifters represent the parts of ourselves we hide. The full moon embodies transformation. Magic reflects emotional truth—not as gimmick, but as a natural extension of the world and its people.
                                    </p>
                                </div>
                                
                                <div className="bg-gradient-to-br from-slate-800/60 to-slate-900/60 p-8 rounded-lg border border-slate-700/50">
                                    <h3 className="heading-font text-3xl font-semibold text-amber-200 mb-4">
                                        💔 Healing Old Wounds
                                    </h3>
                                    <p className="text-amber-100/90 leading-relaxed">
                                        This isn't a story of first love—it's about second chances. About learning that vulnerability is strength, that coming home can be the bravest journey, and that love rebuilt with intention is worth the risk.
                                    </p>
                                </div>
                                
                                <div className="bg-gradient-to-br from-amber-800/40 to-orange-800/40 p-8 rounded-lg border border-amber-600/50">
                                    <h3 className="heading-font text-3xl font-semibold text-amber-200 mb-4">
                                        👥 Found Family
                                    </h3>
                                    <p className="text-amber-100/90 leading-relaxed">
                                        Maple Hollow isn't just a setting—it's a character. The pack, the town, the community that never forgot Ethan. Belonging matters as much as romance, and both are earned through trust and time.
                                    </p>
                                </div>
                            </div>
                            
                            <div className="bg-zinc-900/60 p-10 rounded-lg border border-amber-800/30 text-center">
                                <h3 className="heading-font text-4xl font-semibold text-amber-200 mb-6">
                                    What to Expect
                                </h3>
                                <div className="grid md:grid-cols-3 gap-6 text-left">
                                    <div>
                                        <p className="font-semibold text-amber-300 mb-2">✨ Slow Burn Romance</p>
                                        <p className="text-sm text-amber-100/80">Tension builds gradually, intimacy is earned, and every touch matters</p>
                                    </div>
                                    <div>
                                        <p className="font-semibold text-amber-300 mb-2">🔥 Heat Level: 4/5</p>
                                        <p className="text-sm text-amber-100/80">Open-door intimacy rooted in emotional connection and vulnerability</p>
                                    </div>
                                    <div>
                                        <p className="font-semibold text-amber-300 mb-2">🕊️ Low Angst</p>
                                        <p className="text-sm text-amber-100/80">Emotionally charged but cozy—no melodrama or manufactured conflict</p>
                                    </div>
                                </div>
                                <div className="mt-8 p-6 bg-amber-900/30 rounded border border-amber-700/30">
                                    <p className="text-amber-100 italic text-lg">
                                        "This book feels like coming home while holding someone's hand in the dark."
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Footer */}
                    <div className="bg-zinc-950 border-t border-amber-800/30 py-12">
                        <div className="max-w-6xl mx-auto px-6 text-center">
                            <h3 className="heading-font text-4xl font-bold text-amber-100 mb-4">
                                Moonlight on Maple Hollow
                            </h3>
                            <p className="text-amber-300 mb-6">
                                A paranormal romance for readers who believe the most powerful magic is being truly seen by another person.
                            </p>
                            <div className="flex gap-4 justify-center flex-wrap text-sm mb-8">
                                <span className="text-amber-400">🏳️‍🌈 M/M Romance</span>
                                <span className="text-amber-400">🐺 Shifter Fiction</span>
                                <span className="text-amber-400">🍂 Autumn Setting</span>
                                <span className="text-amber-400">💛 Second Chance Love</span>
                            </div>
                            <p className="text-amber-500 text-sm">
                                © 2025 • All rights reserved
                            </p>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Simple component to render chapter previews from /chapters/*.md
        const ChaptersViewer = () => {
            const [selected, setSelected] = useState(0);
            const [contentFull, setContentFull] = useState('');
            const [contentPreview, setContentPreview] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [counts, setCounts] = useState({});
            const [showFull, setShowFull] = useState(false);
            const [fallbackNote, setFallbackNote] = useState('');
            const [currentPath, setCurrentPath] = useState('');

            const chapters = CHAPTERS;

            // Respond to quick-jump events from the navbar
            useEffect(() => {
                const handler = (e) => {
                    const idx = e.detail;
                    if (typeof idx === 'number' && idx >= 0 && idx < chapters.length) {
                        setSelected(idx);
                        setShowFull(false);
                        // Scroll the reader into view for convenience
                        try {
                            document.getElementById('root')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        } catch {}
                    }
                };
                window.addEventListener('chapters:select', handler);
                return () => window.removeEventListener('chapters:select', handler);
            }, [chapters.length]);

            // Load markdown for the selected chapter
            useEffect(() => {
                const load = async () => {
                    setLoading(true); setError(''); setContentFull(''); setContentPreview(''); setFallbackNote(''); setCurrentPath('');
                    try {
                        const preview = chapters[selected]?.file;
                        const draft = draftsFilenameFor(preview);
                        // Attempt primary target based on toggle
                        const primary = showFull ? `full/${draft}` : preview;
                        const base = new URL(window.location.href);
                        const tryFetch = async (rel) => {
                            const u = new URL(`chapters/${rel}`, base);
                            const r = await fetch(u);
                            return { ok: r.ok, status: r.status, text: r.ok ? await r.text() : '' , rel };
                        };

                        let attempt = await tryFetch(primary);
                        // Fallback: if preview missing and not in showFull mode, try full draft automatically
                        if (!attempt.ok && !showFull) {
                            const alt = `full/${draft}`;
                            const altAttempt = await tryFetch(alt);
                            if (altAttempt.ok) {
                                attempt = altAttempt;
                                setFallbackNote('Preview not available; showing full draft.');
                            }
                        }

                        if (!attempt.ok) {
                            throw new Error(`Failed to load ${primary} (${attempt.status})`);
                        }

                        setCurrentPath(attempt.rel);
                        let md = fixMojibake(attempt.text);
                        // Inject version into first heading if possible
                        const verMatch = draft.match(/_v(\d+)\.md$/);
                        const ver = verMatch ? `v${verMatch[1]}` : '';
                        if (ver) {
                            const injected = md.replace(/^(#\s*.*?Chapter\s+\d+)(\s+—\s+)/m, `$1 ${ver} — `);
                            if (injected !== md) {
                                md = injected;
                            } else {
                                // If no heading match, prepend one derived from chapters array
                                const title = chapters[selected]?.title || 'Chapter';
                                const withVer = title.replace(/(Chapter\s+\d+)/, `$1 ${ver}`);
                                md = `# ${withVer}\n\n${md}`;
                            }
                        }
                        const html = DOMPurify.sanitize(marked.parse(md));
                        setContentFull(html);
                        // Build a preview with first two paragraphs (and keep the first heading if present)
                        try {
                            const container = document.createElement('div');
                            container.innerHTML = html;
                            const out = document.createElement('div');
                            const heading = container.querySelector('h1, h2, h3');
                            if (heading) out.appendChild(heading.cloneNode(true));
                            const paragraphs = container.querySelectorAll('p');
                            let added = 0;
                            for (const p of paragraphs) {
                                out.appendChild(p.cloneNode(true));
                                added++;
                                if (added >= 2) break;
                            }
                            const previewHtml = out.innerHTML || html;
                            setContentPreview(previewHtml);
                        } catch {
                            setContentPreview(html);
                        }
                    } catch (e) {
                        let msg = e.message || 'Failed to load preview.';
                        if (window.location.protocol === 'file:') {
                            msg += ' Tip: When opening this file directly (file://), browsers block fetch. Run a local server from the docs/ folder (e.g., python3 -m http.server) or view via GitHub Pages.';
                        }
                        setError(msg);
                    } finally {
                        setLoading(false);
                    }
                };
                load();
            }, [selected, showFull]);

            // Load word counts CSV once
            useEffect(() => {
                const loadCounts = async () => {
                    try {
                        const base = new URL(window.location.href);
                        const url = new URL('data/word_count_tracker.csv', base);
                        const res = await fetch(url);
                        if (!res.ok) return; // silently ignore
                        const csv = await res.text();
                        const lines = csv.trim().split(/\r?\n/);
                        const header = lines.shift();
                        const map = {};
                        for (const line of lines) {
                            const parts = line.split(',');
                            const filename = parts[0]?.trim();
                            const count = parseInt(parts[1]?.trim(), 10);
                            if (filename && Number.isFinite(count)) {
                                map[filename] = count;
                            }
                        }
                        setCounts(map);
                    } catch {}
                };
                loadCounts();
            }, []);

            const draftsFilenameFor = (file) => file.replace(/\.md$/, '_v1.md');
            const wordsFor = (file) => {
                const key = draftsFilenameFor(file);
                const n = counts[key];
                if (!Number.isFinite(n)) return null;
                return n.toLocaleString();
            };

            return (
                <div className="grid md:grid-cols-3 gap-8">
                    {/* List */}
                    <div className="md:col-span-1 bg-zinc-900/60 border border-amber-800/30 rounded-lg p-4">
                        <h3 className="heading-font text-2xl text-amber-200 mb-4">Chapters</h3>
                        <ul className="space-y-2">
                            {chapters.map((c, idx) => (
                                <li key={c.id}>
                                    <button
                                        onClick={() => setSelected(idx)}
                                        className={`w-full text-left p-3 rounded border transition-all ${
                                            selected === idx
                                                ? 'bg-amber-900/50 border-amber-600 text-amber-100'
                                                : 'bg-zinc-900/40 border-amber-800/30 text-amber-300 hover:bg-amber-900/30'
                                        }`}
                                    >
                                        <p className="font-semibold">{c.title}</p>
                                        <p className="text-xs italic opacity-80 mt-0.5">{wordsFor(c.file) ? `${wordsFor(c.file)} words` : '—'}</p>
                                        <p className="text-sm opacity-80">{c.blurb}</p>
                                    </button>
                                </li>
                            ))}
                        </ul>
                    </div>

                    {/* Reader */}
                    <div className="md:col-span-2">
                        <div className="flex items-center justify-between mb-3">
                            <div className="text-amber-300 text-sm">
                                <label className="inline-flex items-center gap-2 cursor-pointer select-none">
                                    <input type="checkbox" checked={showFull} onChange={() => setShowFull(v => !v)} />
                                    <span>Show full draft</span>
                                </label>
                            </div>
                            <div className="text-amber-400 text-xs italic">Paragraph spacing increased for easier reading</div>
                        </div>
                        {fallbackNote && (
                            <p className="text-amber-300 text-sm mb-2">{fallbackNote}</p>
                        )}
                        <div className="bg-zinc-900/60 border border-amber-800/30 rounded-lg p-6 min-h-[24rem]">
                            {loading && (
                                <p className="text-amber-300">Loading preview…</p>
                            )}
                            {error && (
                                <p className="text-red-300">{error}</p>
                            )}
                            {!loading && !error && (
                                <article className="chapter-content prose prose-invert max-w-none prose-p:mb-6" dangerouslySetInnerHTML={{ __html: showFull ? contentFull : (contentPreview || contentFull) }} />
                            )}
                        </div>
                        {!loading && !error && !showFull && contentFull && contentPreview && contentPreview !== contentFull && (
                            <div className="mt-3">
                                <button
                                    onClick={() => setShowFull(true)}
                                    className="px-4 py-2 rounded bg-amber-700 text-white hover:bg-amber-600 transition"
                                >
                                    View more
                                </button>
                            </div>
                        )}
                        <div className="mt-4 flex items-center justify-between">
                            <button
                                onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
                                className="px-4 py-2 rounded bg-amber-700 text-white hover:bg-amber-600 transition"
                                aria-label="Back to top"
                            >
                                Back to top
                            </button>
                            <a
                                href={`chapters/${currentPath || (showFull ? 'full/' + draftsFilenameFor(chapters[selected]?.file) : chapters[selected]?.file)}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="text-amber-300 hover:text-amber-100 underline"
                            >
                                Open raw markdown
                            </a>
                        </div>
                    </div>
                </div>
            );
        };


        ReactDOM.render(<MoonlightPromo />, document.getElementById('root'));
    </script>
</body>
</html>
